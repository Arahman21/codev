<script src="lib/dhtmlxScheduler/dhtmlxscheduler.js" type="text/javascript"></script>
<script src="lib/dhtmlxScheduler/ext/dhtmlxscheduler_timeline.js" type="text/javascript"></script>
<script src="http://export.dhtmlx.com/scheduler/api.js"></script>  
<link rel="stylesheet" href="lib/dhtmlxScheduler/dhtmlxscheduler_flat.css" type="text/css">
<style type="text/css" media="screen">

   div.dhx_cal_data table {
      background-color: #fff;
      border: 0px;
      padding: 0px;
   }

   tbody th, tbody td, tfoot td {
      padding: 0px;
   }
   
   .dhx_cal_navline {
      z-index:0;
   }

</style>
<div class="scheduler">
   <div id="tabsScheduler" class="float tabs {$ui_tabs_jquery}" style="width:100%; margin-top:1em;" >
      
      <ul class="{$ui_tabs_jquery_ul}">
         <li class="{$ui_tabs_jquery_li}"><a href="#tabsScheduler_tabPlanning">{t}Planning{/t}</a></li>
         <li class="{$ui_tabs_jquery_li}"><a href="#tabsScheduler_tabOptions">{t}Options{/t}</a></li>
         <li class="{$ui_tabs_jquery_li}"><a href="#tabsScheduler_tabRAF">{t}RAF{/t}</a></li>
      </ul>
      
      <div id="tabsScheduler_tabPlanning" >
         <div id="scheduler_here" class="dhx_cal_container" style='height:600px'>
            <div class="dhx_cal_navline">
               <div class="dhx_cal_prev_button">&nbsp;</div>
               <div class="dhx_cal_next_button">&nbsp;</div>
               <div class="dhx_cal_today_button"></div>
               <div class="dhx_cal_date"></div>
            </div>
            <div class="dhx_cal_header"></div>
            <div class="dhx_cal_data"></div>      
         </div>
      </div>
      
      <div id="tabsScheduler_tabOptions">
         <strong>
            {t}Affect users to tasks{/t}
         </strong>
         <form>
            <table>
               <tbody>
                  <tr>
                     <td>
                        <label>{t}Task{/t}: </label>
                     </td>
                     <td>
                        <select class="scheduler_taskList select2" style="min-width:300px;">
                           {foreach from=$scheduler_taskList key=id item=i}
                           <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.id} - {$i.name}</option>
                           {/foreach}
                        </select>
                     </td>
                  </tr>
                  <tr class="scheduler_usersAffectations" hidden>
                     <td>
                        <label>{t}User{/t}: </label>
                     </td>
                     <td>
                        <select class="scheduler_userList select2" style="min-width:300px;">
                           {foreach from=$scheduler_userList key=id item=i}
                           <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
                           {/foreach}
                        </select>
                     </td>
                     <td>
                        <input type="button" value="{t}Add user{/t}" class="scheduler_addUserButton">
                     </td>
                  </tr>
               </tbody>
            </table>
            
         </form>
         <div class="scheduler_usersAffectations" hidden>
            <div class="scheduler_addedUsers">
               <table>
                  <thead>
                     <th></th>
                     <th>{t}User{/t}</th>
                     <th>{t}Time on task{/t}</th>
                     <th></th>
                  </thead>
                  <tbody>
                  </tbody>
               </table>
            </div>
            
            <div>
               <label>{t}Total affected effort{/t}: </label>
               <span class="scheduler_totalAffectedEffortComparison">
                  <span class="scheduler_totalAffectedEffort">0</span>
                  <span>/</span>
                  <span class="scheduler_taskEffortEstim">0</span>
               </span>
            </div>

            <div>
               <input type="button" value="{t}Save modifications for this task{/t}" class="scheduler_saveTaskModificationsButton" disabled>
            </div>
            <div class="scheduler_messageSave success_font">
            </div>
            
            <div>
               <input type="button" value="{t}Generate planning{/t}" class="scheduler_generatePlanningButton" disabled>
            </div>
         </div>
         
         <div class="scheduler_timePerUsersPerTaskSummary">
            <table>
               <thead>
                  <th>{t}Task{/t}</th>
                  <th>{t}Users{/t}</th>
               </thead>
               <tbody>
                  
               </tbody>
            </table>
         </div>
      </div>
      <div id="tabsScheduler_tabRAF">
         <table>
            <thead>
               <th>User</th>
               <th>Task</th>
               <th>Backlog</th>
            </thead>
            <tbody id="backlogTableBody">
            </tbody>
         </table>
      </div>
   </div>
</div>
<input value="Export to Excel" type="button" onclick='exportToExcel()'>
<button onclick="createSchedulerTable()"></button>

<script src="js/scheduler.js" type="text/javascript"></script>
<script src="js/schedulerOptions.js" type="text/javascript"></script>

<script>
   
   // Declare javascript variable with smarty variable
   var timePerUserPerTask = {$scheduler_taskId};
   var jsonTimetrackData;
   var jsonUserData;
   var jsonProjectionData;
   
   scheduler.locale.labels.m_tab = "Timeline Month";
   scheduler.locale.labels.section_custom="Section";
   scheduler.config.xml_date="%Y-%m-%d %h:%i";
   



   scheduler.config.readonly = true;
   scheduler.config.full_day = true;


   $( "#tabsScheduler" ).on( "tabscreate", function( event, ui ) {
      initSchedulerOptions();
      createSchedulerTable();
   });
   
   function exportToExcel() {
      scheduler.exportToExcel(
         { name:"My document", columns:[
            { id:"user_id",  header:"user", width:20 },
            { id:"text",  header:"Title", width:20 },
            { id:"start_date",  header:"Start date", width:20 },
            { id:"end_date",  header:"Start date", width:20 }
         ]}
      );
   }
   
</script>

