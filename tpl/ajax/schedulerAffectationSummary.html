
<div >
   <table id="tabsScheduler_AffectationSummaryTable" class="datatable_csv">
      <thead>
         <th></th>
         
         <th>{t}Task Id{/t}</th>
         <th></th>
         <th>{t}Task Name{/t}</th>
         <th>{t}External Reference{/t}</th>
         <th>{t}Users{/t}</th>
         
      </thead>
      <tbody>
         {foreach from=$scheduler_timePerUserPerTaskInfosList key=taskId item=$task}
         <tr class="scheduler_taskRow" data-taskId="{$taskId}" data-projectId="{$task.projectId}">
            <td class="ui-state-error-text pointer removeTaskAffectation"><a class="ui-icon"></a></td>
            
            <td><a href="reports/issue_info.php?bugid={$taskId}">{$taskId}</a></td>
            <td class="summaryTableTaskDisplay pointer"><img src="images/b_goto.png"></td>
            <td>{$task.summary}</td>
            <td>{$task.externalReference}</td>
            <td>
               {foreach from=$task.users key=$userName item=$time}
               <span>{$userName} ({$time})  </span>
               {/foreach}
            </td>
            
         </tr>
         {/foreach}
      </tbody>
   </table>
</div>

<!--Can cause problems on datatables
   Added to remake "just added table" a datatable-->
<script src="js_min/datatable.min.js" type="text/javascript"></script>

<script>
   // On display task button click
   jQuery(".summaryTableTaskDisplay").on("click", function(){
      var taskId = jQuery(this).parent(".scheduler_taskRow").attr("data-taskId");
      var projectId = jQuery(this).parent(".scheduler_taskRow").attr("data-projectId");
      var taskList = jQuery("select.scheduler_taskList");
      var projectList = jQuery("select.scheduler_projectList");
      
      // If clicked task exist in select list
      if(null != taskList.find("option[value=" + taskId + "]").val())
      {
         // Select task
         taskList.val(taskId);
         // Trigger change event on task list to update
         taskList.trigger("change");
      }
      else
      {
         projectList.val(projectId);
         projectList.trigger("change");
         taskList.val(taskId);
         taskList.trigger("change");
      }
      
   });
   
   // On remove button click
$(".removeTaskAffectation").on("click", function(){
   var parentRow = jQuery(this).parent("tr.scheduler_taskRow");
   var taskId = parentRow.attr("data-taskId");

   jQuery.ajax({ 
      url: 'reports/scheduler_ajax.php',
      async:false,
      data: {
         action: 'setTaskUserList',
         taskId: taskId,
         taskUserList: "",
      },
      type: 'post',
      success: function(data) {
         data = JSON.parse(data);
         
         if(null != data['scheduler_summaryTableHTML'])
         {
           setTimePerUsersPerTaskSummaryTable(data['scheduler_summaryTableHTML']);
         }
         
         var messageSaveContainer = jQuery(".scheduler_messageSave");
         if(null != data["scheduler_message"])
         {
            if("SUCCESS" == data["scheduler_status"])
            {
               messageSaveContainer.removeClass("error_font");
               messageSaveContainer.addClass("success_font");
               messageSaveContainer.text(data["scheduler_message"]);
            }
            else
            {
               messageSaveContainer.removeClass("success_font");
               messageSaveContainer.addClass("error_font");
               messageSaveContainer.text(data["scheduler_message"]);
            }
         }
         else
         {
            console.log("error : no message received from server");
         }
         
      },
      error: function(errormsg) {
         console.log(errormsg);
      }
   });
});

   
</script>