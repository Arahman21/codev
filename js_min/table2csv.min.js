jQuery.fn.table2CSV=function(e){function t(t){var n=t.join("");if(t.length>0&&""!=n){var r=t.join(e.separator);i[i.length]=r}}function n(e){var t=new RegExp(/["]/g),n=e.replace(t,"â€œ"),t=new RegExp(/\<[^\<]+\>/g),n=n.replace(t,"");return""==n?"":'"'+n+'"'}function r(e){var t=window.open("","csv","height=400,width=600");return t.document.write("<html><head><title>CSV</title>"),t.document.write("</head><body >"),t.document.write('<textArea cols=70 rows=15 wrap="off" >'),t.document.write(e),t.document.write("</textArea>"),t.document.write("</body></html>"),t.document.close(),!0}var e=jQuery.extend({separator:";",header:[],delivery:"file",filename:"output.csv"},e),i=[],o=this,a=e.header.length,d=[];if(a>0)for(var h=0;a>h;h++)d[d.length]=n(e.header[h]);if(t(d),$(o).find("tr").each(function(){var e=[];$(this).find("th, td").each(function(){"none"!=$(this).css("display")&&(e[e.length]=n($(this).html()))}),t(e)}),"popup"==e.delivery){var l=i.join("\n");return r(l)}if("file"==e.delivery){var l=i.join("\n");return saveTextAs(l,e.filename)}var l=i.join("\n");return l};