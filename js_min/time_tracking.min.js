function getIssuesAndDurations(a){a.preventDefault();var b=!0;if(b){var c=jQuery("#projectid").val(),d=jQuery("#getIssuesAndDurationsForm");d.find("input[name=projectid]").val(c);var e=jQuery("#bugid");e.empty(),e.select2("data",null),e.append(jQuery("<option>").attr("value","0").append(timetrackingSmartyData.i18n_pleaseWait).attr("selected","selected")),jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:d.attr("method"),dataType:"json",data:d.serialize(),success:function(a){e.empty(),e.select2("data",null);var b=a.availableIssues,c=0;for(var d in b)b.hasOwnProperty(d)&&c++;c>1&&e.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));var g,f="";for(var h in b)b.hasOwnProperty(h)&&(g=b[h],f=null!=g.tcId&&""!=g.tcId?h+" / "+g.tcId+" : "+g.summary:h+" : "+g.summary,e.append(jQuery("<option>").attr("value",h).append(f)));var i=jQuery("#job");i.empty();var j=a.availableJobs,k=0;for(var d in j)j.hasOwnProperty(d)&&k++;k>1&&i.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));for(var h in j)j.hasOwnProperty(h)&&i.append(jQuery("<option>").attr("value",h).append(j[h]));jQuery("#duree").empty();var l=a.availableDurations;for(var h in l)l.hasOwnProperty(h)&&jQuery("#duree").append(jQuery("<option>").attr("value",h).append(l[h]))}})}}function deleteTrack(a,b,c,d,e,f){jQuery("#desc_date").text(b),jQuery("#desc_id").text(c),jQuery("#desc_duration").text(d),jQuery("#desc_job").text(e),jQuery("#desc_summary").text(f),jQuery("#formDeleteTrack").find("input[name=trackid]").val(a),jQuery("#deleteTrack_dialog_form").dialog("open")}jQuery(document).ready(function(){function d(){a.find("input[name=projectid]").val(jQuery("#projectid").val()),a.find("input[name=bugid]").val(jQuery("#bugid").val()),a.find("input[name=job]").val(jQuery("#job").val()),a.find("input[name=duree]").val(jQuery("#duree").val())}"en"!=timetrackingSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate),jQuery("#projectid").change(function(a){getIssuesAndDurations(a)}),jQuery("#filters").click(function(a){a.preventDefault(),jQuery("#setfilter_dialog_form").dialog("open")}),jQuery("#bugid").change(function(){if("0"===jQuery("#projectid").val()){var a=jQuery("#form1");a.find("input[name=action]").val("setBugId"),a.find("input[name=weekid]").val(jQuery("#weekid").val()),a.find("input[name=year]").val(jQuery("#year").val()),a.submit()}}),jQuery("#btAddTrack").click(function(){var a=0,b=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n",c=jQuery("#form1"),d=c.find("select[name=bugid]").val(),e=c.find("select[name=job]").val(),f=c.find("select[name=duree]").val();if("0"===d&&(b+=timetrackingSmartyData.i18n_task+"\n",++a),"0"===e&&(b+=timetrackingSmartyData.i18n_job+"\n",++a),"0"===f&&(b+=timetrackingSmartyData.i18n_duration+"\n",++a),0===a){var g=jQuery("#datepicker").val(),h=getUpdateBacklogData(d,timetrackingSmartyData.userid,e,f,g);h.done(function(a){"BacklogUpdateNotNeeded"===a.diagnostic?(c.find("input[name=action]").val("addTrack"),c.submit()):(jQuery("#formUpdateBacklog").off("submit"),openUpdateBacklogDialogbox(a))})}else alert(b)}),jQuery("#setfilter_dialog_form").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var a=jQuery("#formSetFilters");a.find("input[name=projectid]").val(jQuery("#projectid").val()),a.find("input[name=bugid]").val(jQuery("#bugid").val()),a.find("input[name=job]").val(jQuery("#job").val()),a.find("input[name=duree]").val(jQuery("#duree").val()),a.find("input[name=weekid]").val(jQuery("#weekid").val()),a.find("input[name=year]").val(jQuery("#year").val()),a.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var a=jQuery("#formUpdateWeek");jQuery("#form1"),jQuery("#formUpdateBacklog");jQuery("#previousweek").click(function(){d();var b=jQuery("#weekid").val();if(1!=b)a.find("select[name=weekid]").val(--b);else{var c=jQuery("#year").val(),e=+c-1,f=timetrackingSmartyData.nbWeeksPrevYear;a.find("select[name=weekid]").val(f),a.find("select[name=year]").val(e)}a.submit()}),jQuery("#nextweek").click(function(){d();var b=jQuery("#weekid").val();if(parseInt(b)<parseInt(timetrackingSmartyData.nbWeeksThisYear))a.find("select[name=weekid]").val(++b);else{var c=jQuery("#year").val(),e=+c+1;a.find("select[name=weekid]").val(1),a.find("select[name=year]").val(e)}a.submit()}),jQuery("#weekid, #year").change(function(){d(),a.submit()}),jQuery("#deleteTrack_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:{Delete:function(){jQuery("#formDeleteTrack").submit()},Cancel:function(){jQuery(this).dialog("close")}}}),jQuery(".editWeekTimetrack_link").click(function(a){a.preventDefault();var b=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getEditTimetrackData",timetrackId:b},dataType:"json",success:function(a){if("SUCCESS"===a.statusMsg){$("#timeToEdit").empty();var c=a.durationsList;for(var d in c)c.hasOwnProperty(d)&&$("#timeToEdit").append($("<option>").attr("value",d).append(c[d]));$("#editJob").empty();var e=a.availableJobs;for(var d in e)e.hasOwnProperty(d)&&$("#editJob").append($("<option>").attr("value",d).append(e[d]));$("#timetrackId").val(b),$("#timeToEdit").val(a.duration),$("#editJob").val(a.jobid),$("#issue_note_edit").val(a.note),$("#taskSummary").text(a.issueSummary),$("#datepickerEditer").datepicker("setDate",a.date),$("#editWeekTimetrack_dialog").dialog("open")}else console.error("Ajax statusMsg",a.statusMsg),alert(a.statusMsg)},error:function(a,b,c){console.error(b,c),alert("ERROR: Please contact your CodevTT administrator")}})}),$("#editWeekTimetrack_dialog").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var a=$("#issue_note_edit").val(),b=$("#datepickerEditer").val(),c=$("#timeToEdit").val(),d=$("#editJob").val(),e=$("#timetrackId").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:e,note:a,date:b,duration:c,jobid:d,userid:timetrackingSmartyData.userid,weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(a){if("SUCCESS"===a.statusMsg){var b=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+e+"]");b.find(".weekTimetrack_duration").text(c),b.find(".weekTimetrack_date").text(a.cosmeticDate),b.find(".weekTimetrack_jobName").text(a.jobName),jQuery("#weekTaskDetailsDiv").html(jQuery.trim(a.timesheetHtml)),updateWidgets("#weekTaskDetailsDiv")}else console.error("Ajax statusMsg",a.statusMsg),alert(a.statusMsg)},error:function(a,b,c){console.error(b,c),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});